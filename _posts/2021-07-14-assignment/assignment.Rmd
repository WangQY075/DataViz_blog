---
title: "Assignment"
description: |
  A short description of the post.
author:
  - name: Qinyu Wang
    url: https://www.linkedin.com/in/qinyu-wang/
date: 07-14-2021
output:
  distill::distill_article:
    distill::distill_article:
    toc: true
    toc_float: true
    self_contained: false
---


# Library Packages
```{r}
packages = c('raster', 'sf', 
             'tmap', 'clock', 
             'tidyverse','ggplot2','ggraph',
             'lubridate','ggthemes','viridis')
for (p in packages){
  if(!require(p, character.only = T)){
    install.packages(p)
  }
  library(p,character.only = T)
}
```

# Import data
```{r}
cc_data<- read_csv('D:/ISSS608 Data Visualization/MC2/MC2/cc_data.csv')
loyalty_data <- read_csv('D:/ISSS608 Data Visualization/MC2/MC2/loyalty_data.csv')
cc_data_wkday <- cc_data
```

# Cleaning data
```{r}

```

# Plot 1 canlendar heat map of cc_card data by shops
```{r}
cc_data_wkday$dmy_hm <- date_time_parse(cc_data_wkday$timestamp,
                zone = "",
                format = "%m/%d/%Y %H:%M")

cc_data_wkday$weekday <- wday(cc_data_wkday$dmy_hm, 
                             label = TRUE, 
                             abbr = FALSE)

cc_data_wkday$date <-  dmy(cc_data_wkday$dmy_hm)

cc_data_wkday$hour <- as.numeric(hour(cc_data_wkday$dmy_hm))

cc_data_wkday <- cc_data_wkday %>% 
 mutate(location=recode(location,'Katerina�s Caf�'= "Katerina's Cafe"))
```

plot <- cc_data_wkday %>% 
  group_by(location,weekday,hour) %>% 
  count(hour) %>% 
  ungroup() %>% 
  arrange(location,desc(n)) %>% 
  ungroup()

full_df <- expand.grid(location = unique(cc_data_wkday$location),
                       weekday = unique(cc_data_wkday$weekday),
                       hour = as.numeric(c(1:23)))

plot2 <- plot %>% 
  right_join(
    full_df,
    by = c('location','weekday','hour') 
  ) %>% 
  group_by(location,weekday) %>%
  arrange(location,weekday,hour) %>% 
  ungroup() %>% 
  replace_na(list(n = 0L)) %>% 
  mutate(hour1 = as.ordered(hour))

ggplot(plot, aes(hour, weekday, fill = n) ) + 
geom_tile(color = "white", size = 0.1)+
facet_wrap( ~location)

```
  