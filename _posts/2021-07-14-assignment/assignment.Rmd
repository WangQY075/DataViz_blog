---
title: "Assignment"
description: |
  A short description of the post.
author:
  - name: Qinyu Wang
    url: https://www.linkedin.com/in/qinyu-wang/
date: 07-14-2021
output:
  distill::distill_article:
    distill::distill_article:
    toc: true
    toc_float: true
    self_contained: false
---


# Library Packages
```{r}
packages = c('raster', 'sf', 
             'tmap', 'clock', 
             'tidyverse','ggplot2','ggraph',
             'lubridate','ggthemes','viridis','plotly')
for (p in packages){
  if(!require(p, character.only = T)){
    install.packages(p)
  }
  library(p,character.only = T)
}
```

# Import data
```{r}
cc_data<- read.csv('D:/ISSS608 Data Visualization/MC2/MC2/cc_data.csv')

loyalty_data <- read.csv('D:/ISSS608 Data Visualization/MC2/MC2/loyalty_data.csv')

cc_data_wkday <- cc_data
```

# Data parperation
```{r}
cc_data_wkday$dmy_hm <- date_time_parse(cc_data_wkday$timestamp,
                zone = "",
                format = "%m/%d/%Y %H:%M")

cc_data_wkday$weekday <- wday(cc_data_wkday$dmy_hm, 
                             label = TRUE, 
                             abbr = FALSE)

cc_data_wkday$hour <- hour(cc_data_wkday$dmy_hm)

cc_data_wkday$day <- day(cc_data_wkday$dmy_hm)

cc_data_wkday$last4ccnum <- cc_data_wkday$last4ccnum

```

```{r}
cc_bar_chart <- cc_data_wkday %>% 
  group_by(location) %>% 
  summarise(n = n()) %>% 
  ungroup()

p <- ggplot(cc_bar_chart,aes(x = reorder(location,-n), 
                             y = n)) + 
  geom_col(color="black", 
           fill="light blue") + 
  theme(axis.text.x = element_text(angle = 90, 
                                   hjust = 1, 
                                   vjust = .5)) 

print(p + ggtitle("Location by frequency") + 
        labs(y="Frequency", x = "Location"))

```

# when they are popular
```{r}
plot <- cc_data_wkday %>% 
  group_by(location,weekday,hour) %>% 
  count(hour) %>% 
  ungroup() %>% 
  arrange(location,desc(n)) %>% 
  ungroup()

full_df <- expand.grid(location = unique(cc_data_wkday$location),
                       weekday = unique(cc_data_wkday$weekday),
                       hour = as.numeric(c(1:23)))

plot2 <- plot %>% 
  right_join(
    full_df,
    by = c('location','weekday','hour') 
  ) %>% 
  group_by(location,weekday) %>%
  arrange(location,weekday,hour) %>% 
  ungroup() %>% 
  replace_na(list(n = 0L)) %>% 
  mutate(hour1 = as.ordered(hour))

p <- ggplot(plot2, aes(hour1, weekday, fill = n,fig.height = 500, fig.width = 800) ) + 
geom_tile(color = "white", size = 0.1) +
coord_equal() + 
  facet_wrap( ~location)

p <- ggplotly(p)
ggsave("myplot.jpg")
```
  